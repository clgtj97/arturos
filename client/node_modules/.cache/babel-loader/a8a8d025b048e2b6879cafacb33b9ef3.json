{"ast":null,"code":"// Copyright 2012 Mark Cavage, Inc.  All rights reserved.\n'use strict'; ///--- Helpers\n\n/**\n * @private\n * @function pauseStream\n * @param    {Stream} stream - the stream to pause\n * @returns  {undefined} no return value\n */\n\nfunction pauseStream(stream) {\n  function _buffer(chunk) {\n    stream.__buffered.push(chunk);\n  }\n\n  function _catchEnd(chunk) {\n    stream.__rstfyEnded = true;\n  }\n\n  stream.__rstfyEnded = false;\n  stream.__rstfyPaused = true;\n  stream.__buffered = [];\n  stream.on('data', _buffer);\n  stream.once('end', _catchEnd);\n  stream.pause();\n  stream._resume = stream.resume;\n\n  stream.resume = function _rstfy_resume() {\n    if (!stream.__rstfyPaused) {\n      return;\n    }\n\n    stream.removeListener('data', _buffer);\n    stream.removeListener('end', _catchEnd);\n\n    stream.__buffered.forEach(stream.emit.bind(stream, 'data'));\n\n    stream.__buffered.length = 0;\n\n    stream._resume();\n\n    stream.resume = stream._resume;\n\n    if (stream.__rstfyEnded) {\n      stream.emit('end');\n    }\n  };\n}\n/**\n * This pre handler fixes issues with node hanging when an `asyncHandler` is\n * used prior to `bodyParser`.\n * https://github.com/restify/node-restify/issues/287\n * https://github.com/restify/node-restify/issues/409\n * https://github.com/restify/node-restify/wiki/1.4-to-2.0-Migration-Tips\n *\n * @public\n * @function pause\n * @returns  {Function} Handler\n */\n\n\nfunction pause() {\n  function prePause(req, res, next) {\n    pauseStream(req);\n    next();\n  }\n\n  return prePause;\n} ///--- Exports\n\n\nmodule.exports = pause;","map":null,"metadata":{},"sourceType":"script"}